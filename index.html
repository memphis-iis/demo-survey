<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2015-04-30
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20150430" />
    <meta http-equiv="Content-Language" content="en" />
    <title>demosurvey - </title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Demo-Survey</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2015-04-30</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 0.0.1-SNAPSHOT</li>
                      
                
                    
      
                                              
    <li class="pull-right">              <a href="http://aws.amazon.com/documentation/" class="externalLink" title="AWS Documentation">
        AWS Documentation</a>
  </li>

        <li class="divider pull-right">|</li>
      
    <li class="pull-right">              <a href="https://github.com/memphis-iis/demo-survey/" class="externalLink" title="GitHub Repo">
        GitHub Repo</a>
  </li>

        <li class="divider pull-right">|</li>
      
    <li class="pull-right">              <a href="http://www.memphis.edu/iis/" class="externalLink" title="IIS">
        IIS</a>
  </li>

                        </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Main Information</li>
                                
      <li class="active">
    
            <a href="#"><i class="none"></i>Introduction and Overview</a>
          </li>
                  
      <li>
    
                          <a href="design.html" title="Design Walkthrough">
          <i class="none"></i>
        Design Walkthrough</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                                    
      <li>
    
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-down"></i>
        Project Information</a>
                    <ul class="nav nav-list">
                      
      <li class="active">
    
            <a href="#"><i class="none"></i>About</a>
          </li>
                      
      <li>
    
                          <a href="plugin-management.html" title="Plugin Management">
          <i class="none"></i>
        Plugin Management</a>
            </li>
                      
      <li>
    
                          <a href="distribution-management.html" title="Distribution Management">
          <i class="none"></i>
        Distribution Management</a>
            </li>
                      
      <li>
    
                          <a href="dependency-info.html" title="Dependency Information">
          <i class="none"></i>
        Dependency Information</a>
            </li>
                      
      <li>
    
                          <a href="source-repository.html" title="Source Repository">
          <i class="none"></i>
        Source Repository</a>
            </li>
                      
      <li>
    
                          <a href="mail-lists.html" title="Mailing Lists">
          <i class="none"></i>
        Mailing Lists</a>
            </li>
                      
      <li>
    
                          <a href="issue-tracking.html" title="Issue Tracking">
          <i class="none"></i>
        Issue Tracking</a>
            </li>
                      
      <li>
    
                          <a href="integration.html" title="Continuous Integration">
          <i class="none"></i>
        Continuous Integration</a>
            </li>
                      
      <li>
    
                          <a href="plugins.html" title="Project Plugins">
          <i class="none"></i>
        Project Plugins</a>
            </li>
                      
      <li>
    
                          <a href="license.html" title="Project License">
          <i class="none"></i>
        Project License</a>
            </li>
                      
      <li>
    
                          <a href="team-list.html" title="Project Team">
          <i class="none"></i>
        Project Team</a>
            </li>
                      
      <li>
    
                          <a href="project-summary.html" title="Project Summary">
          <i class="none"></i>
        Project Summary</a>
            </li>
                      
      <li>
    
                          <a href="dependencies.html" title="Dependencies">
          <i class="none"></i>
        Dependencies</a>
            </li>
              </ul>
        </li>
                                                                                                                                            
      <li>
    
                          <a href="project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>demo-survey</h1>
<p>This is a sample app demonstrating how to use Java and Amazon Web Services to create a web form whose results are saved to a database.</p>
<p>In addition to this overview, there is also a <a href="design.html">brief design walkthru</a>. You should also look in <a href="project-reports.html">Project Reports</a> for the JavaDocs and other goodies!</p>
<p>TODO: Links to meep-meep documents TODO: link to videos (overview and AWS setup) TODO: Break into separate documents</p>
<div class="section">
<h2>Introduction and Requirements<a name="Introduction_and_Requirements"></a></h2>
<p>This is a sample project meant to demonstrate how you might create a small data collection website. In this case it&#x2019;s a very simple survey. No one logs in, everyone supplies their own participant code, and the questions are silly.</p>
<p>Since we are demonstrating a web-form whose results are saved to a database, we should define some terms. When you store a piece of data (whether it&#x2019;s a checking account entry, a student&#x2019;s grade, or a set of responses to a survey) it it called a <i>record</i>. Each individual feature of the data (name, grade, withdrawal amount, shoe size, etc) is a <i>field</i>. Often there is a field that whose content uniquely identifies each record, it is called a <i>key</i>. For instance, when your bank gives you an account number, that field is almost certainly the key used to locate your account&#x2019;s record.</p>
<p>We only have a few high-level requirements:</p>

<ol style="list-style-type: decimal">
  
<li>This project will be in Java, since that&#x2019;s a very common development  language around here</li>
  
<li>We should save survey results</li>
  
<li>We want to demonstrate saving each record with a key</li>
  
<li>We want to run this application in the &#x201c;cloud&#x201d; at Amazon Web Services (AWS)</li>
</ol>
<p>We will be making some assumptions about your development workstation</p>

<ul>
  
<li>You have Git installed (which includes Git Bash on Windows)</li>
  
<li>You have the Java 7 (or later) <b>JDK</b> installed</li>
  
<li>You have Apache Maven installed.</li>
  
<li>You have a functional AWS account to use for deployment (at least for testing). If you have an account with Amazon, then you can use it for AWS.</li>
  
<li>You have installed the &#x201c;local&#x201d; version of Amazon DynamoDB. See below for more instructions.</li>
</ul>
<p>All the major Linux distributions have packages for a Java JDK and Maven. You should be able to install Maven via homebrew on a Mac. On a Windows machine, you&#x2019;ll probably need to download and install them yourself. They can be found. Your best bet is probably to Google for them, but as of this writing, they could downloaded here:</p>

<ul>
  
<li><a class="externalLink" href="http://www.oracle.com/technetwork/java/javase/downloads/jdk7-downloads-1880260.html">Java 7 JDK</a></li>
  
<li><a class="externalLink" href="https://maven.apache.org/download.cgi">Maven</a></li>
</ul>
<p>If you use the manual downloads, you&#x2019;ll also want to make sure that the bin directories from both the JDK and the Maven distribution are in your PATH.</p></div>
<div class="section">
<h2>A Brief Overview of Java Web Applications<a name="A_Brief_Overview_of_Java_Web_Applications"></a></h2>
<p>It is assumed that you already understand Java programming and how Java web applications work. However, just in case that&#x2019;s not true, let&#x2019;s go over how a Java application is put together.</p>
<p>A Java web application is compiled into a WAR file, which is just a special kind of JAR. It represents a web application that will be executed by a Java web server. This server can be a simple Servlet/JSP container (like Tomcat or Jetty), or it can be a full-fledged application server (like Wild Fly or GlassFish). In our case it will be Tomcat.</p>
<p>Each WAR file is loaded as a web application (or context) and responds to HTTP requests using Servlets. Servlets are generally classes that implement a special interface. Additionally, Java ServerPages (JSP&#x2019;s) can use a combination of HTML, Java code, and special &#x201c;tags&#x201d; to create HTML output.</p>
<p>The WAR file includes (amoung other things) any JSP&#x2019;s and other content to be served to the user and a special directory named WEB-INF. Inside WEB-INF is a file named web.xml that defined various parameters for the web application, a classes folder with your compiled Java classes, and a lib folder with any JAR&#x2019;s that your web application will need. You may include your own file in WEB-INF, but remember that they will not be immediately accessible to your users. You must write code of some kind to expose any resources in WEB-INF that your users should be able to download.</p>
<p>In general, a Java web server maps each &#x201c;directory&#x201d; at the root of the URL to a WAR file, and the WAR file is responsible for handling URL&#x2019;s in that namespace. For instance, this application will generate a WAR file named demosurvey.WAR. It includes a Servlet named HomeServlet (see edu.memphis.iis.demosurvey.HomeServlet) that is mapped to <tt>/home</tt>. As a result, if we are deployed on a server at <tt>www.somewhere.com</tt> the URL <tt>http://www.somewhere.com/demosurvey/home</tt> will map to our servlet.</p></div>
<div class="section">
<h2>A Quick Introduction to Maven<a name="A_Quick_Introduction_to_Maven"></a></h2>
<p>This is not an extensive introduction to Maven. In fact, you should already by somewhat familiar with Maven (or at least have read some introductory material); however, in the interest of completeness, a brief overview of Maven will be given.</p>
<p>Maven is a build tool with extensive support for transitive dependencies. For instance, if you declare a dependence on library A, which requireds both libraries B and C, each of which required D, then Maven will automatically download all four libraries (A, B, C, and D) for your project. You may specify when you &#x201c;need&#x201d; your dependencies (only to compile, only for testing, etc).</p>
<p><b>Important!</b> If you take nothing else away from this section, remember dependency management. It&#x2019;s important, but even if you disagree, please keep in mind that the Java community has been using automated dependency management for years. As a result, few projects worry about how difficult it will be for you to find all the necessary JAR&#x2019;s to run their code. They assume that a dependency manager will do this for you.</p>
<p>Maven is based around the concept of a &#x201c;Project Object Model&#x201d;, abbreviated by POM. You describe a project with a POM in an XML file named pom.xml and let Maven take care of taks like downloading your dependencies, building your WAR (or JAR) file, running your unit tests, etc. For instance, just running <tt>mvn package</tt> will compile, test, and package your code. In our project, that means that you&#x2019;ll be able to find <tt>demosurvey.war</tt> in the <tt>target</tt> directory.</p>
<p>Maven is based on convention over configuration, so you should follow the Maven conventions. A few to keep in mind:</p>

<ul>
  
<li>Your code, resource files, etc will live in the <tt>src</tt> directory</li>
  
<li>Everything Maven builds for you will end up in the <tt>target</tt> directory. DO <b>NOT</b> add the <tt>target</tt> directory to source code control (you&#x2019;ll notice that it is in the <tt>.gitignore</tt> file in our directory).</li>
  
<li>Your Java code goes in <tt>src/main/java</tt></li>
  
<li>Any resource files (like configuration files you bundled in your WAR) go in <tt>src/main/resources</tt></li>
  
<li>The &#x201c;special&#x201d; contents of your WAR (like JSP&#x2019;s and your WEB-INF directory) go in <tt>src/main/webapp</tt></li>
  
<li>You Java test code goes in <tt>src/test/java</tt></li>
  
<li>Any resources you need to run unit tests go in <tt>src/test/resources</tt></li>
  
<li>If you&#x2019;re using the Maven site command to build an informational site for your project, the site.xml file and any extra content go in <tt>src/site</tt></li>
</ul>
<p>Maven also has a large plugin ecosystem for adding all kinds of functionality to your project. For instance, this project uses the Tomcat plugin. As a result, you can run this project in a special test Tomcat instance on your workstation just by running <tt>mvn tomcat7:run</tt>. However, please &#x201c;Setting Up Your Development Workstation&#x201d; below for real details.</p></div>
<div class="section">
<h2>Setting up your development workstation<a name="Setting_up_your_development_workstation"></a></h2>
<p>As mentioned above you should have Git, a Java JDK (at least version 7), and Maven installed. You will probably want a nice IDE for development like Eclipse or NetBeans. A brief description of setting up an Eclipse development environment will be given, but all the &#x201c;raw&#x201d; Maven commands will be our focus.</p>
<p>In addition to the standard development tools listed above, you&#x2019;ll also want to be able to test the application locally when you make changes. Otherwise you would need to deploy your application to the Amazon cloud every time you wanted to test. We use the Maven Tomcat plugin for hosting our web application, but the application needs a data source. In the Amazon cloud, data is stored in DynamoDB. Luckily Amazon provides &#x201c;local&#x201d; version for testing that emulates enough real functionality for testing. To setup &#x201c;DynamoDB Local&#x201d; you can just follow the directions at <a class="externalLink" href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Tools.DynamoDBLocal.html">http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Tools.DynamoDBLocal.html</a></p>
<p>Basically, you just need to:</p>

<ul>
  
<li>Download the .zip or .tar.gz archive</li>
  
<li>Extract everything somewhere appropriate</li>
  
<li>Run the server whenever you are testing. Below this directory will be referred to as the &#x201c;DynamoDB directory&#x201d;</li>
</ul>
<p>That last step is the doozy: if you aren&#x2019;t running the local DynamoDB server, the web application will have errors when your are running in on your local workstation. You can still write code, execute the unit tests, push your changes to a repository, etc, but you won&#x2019;t be able to actually run the entire web application if you aren&#x2019;t running DynamoDB Local.</p>
<p>Unfortunately there isn&#x2019;t a simple script file (BAT file for Windows people) in the distributed files for running the server. You can create your own and just add the line: <tt>java -Djava.library.path=./DynamoDBLocal_lib -jar DynamoDBLocal.jar</tt>. Then when you want to run the server, you can open your terminal (command prompt for Windows people), <tt>cd</tt> to your DynamoDB directory, and run your script file.</p>
<p>You might also want to download a tool like the SQLite Browser available at <a class="externalLink" href="http://sqlitebrowser.org/">http://sqlitebrowser.org/</a>. DynamoDB Local uses SQLite to store data, so while you are testing you can just use this handy browser to view the data in the file <tt>TEST_us-east-1.db</tt> in your DynamoDB directory.</p>
<p>Assuming that you have already above setup and your DynamoDB Local is running, you&#x2019;re ready to get the latest code, build the web application, and test. To do all this you only need three commands:</p>

<div class="source">
<pre>$ git clone https://github.com/memphis-iis/demo-survey.git
$ cd demo-survey
$ mvn tomcat7:run
</pre></div></div>
<div class="section">
<h2>Deploying the Documentation<a name="Deploying_the_Documentation"></a></h2>
<p>To provide a complete example, this project uses a somewhat advanced technique. Maven is used to generate a local site, and that site is pushed to a special branch on GitHub where it is served as a GitHub Pages Project Page. In fact, that&#x2019;s what you&#x2019;re reading now.</p>
<p>Maven provides the <tt>site</tt> goal, which automatically generates a project site that reports all the various project data contained in the <tt>pom.xml</tt> file. It also allows additional pages to be added to the site. The site configuration file (<tt>site.xml</tt>) and the additional pages are all located in the <tt>src/site</tt> directory.</p>
<p>GitHub provides a way of hosting pages for each project. The web pages are committed to a special branch named gh-pages. They are then displayed at a special URL based on the GitHub organization/user and the project name. In our case, we just upload our static site as generated by Maven. You may also use GitHub&#x2019;s jekyll processing to create a site that is pre-rendered for you. If you&#x2019;re interested, you can check out our meep-meep project for an example of using this extra functionality.</p>
<p>The script won&#x2019;t be described in detail at this time since it&#x2019;s a fairly advanced example of git usage. However, we&#x2019;ll quickly explain the basic logic of the script. Please keep in mind that the following points may not make much sense unless you&#x2019;ve a fairly advanced git user. They are here to demonstrate how much you can automate with git, a build system like Maven, and a little scripting.</p>

<ol style="list-style-type: decimal">
  
<li>After some housekeeping, the main branch (&#x201c;master&#x201d;) is checked out and  any changes in the repository are pulled. Then same is done for the  target branch (&#x201c;gh-pages&#x201d;), and then we switch back to master. All of  this is to ensure that we our eventual push will succeed and that some  of the helpful things that git does for us on checkout are already handled</li>
  
<li>We use Maven to generate the site files. Note that we also check to make  sure that our files are there.</li>
  
<li>We change git&#x2019;s symbolic ref HEAD to point to gh-pages and reset the current  working tree to be the generated site directory (<tt>target/site</tt>)</li>
  
<li>We (recursively) add the all the generated files in the generated site  directory, commit the changes, and push them to GitHub.</li>
  
<li>We reset the symbolic ref HEAD and reset the working directory</li>
</ol></div>
<div class="section">
<h2>Deploying to AWS<a name="Deploying_to_AWS"></a></h2>
<p>Currently, all of this is documented in our AWS setup video. However, in the interest of completeness we&#x2019;ll note some things to remember:</p>
<p>If you&#x2019;re using an account that has never used Elastic Beanstalk before you can just use the demo setup. <b>Be sure to select a Tomcat application and change the default to Tomcat 7</b> However, you&#x2019;ll still need to add DynamoDB security to the IAM role.</p>

<ul>
  
<li>
<p>You will need an application environment. You want a Tomcat environment for  Tomcat 7. This is mainly what is created for you if you use the first-time  demo setup. Unless money is no object, you should also select the &#x201c;Single  Instance&#x201d; environment type.</p></li>
  
<li>
<p>You will need to create an IAM role or select an existing IAM role. If you  are using the first-time demo setup, one will be created and selected for you  automatically.</p></li>
  
<li>
<p>You will need to add the AmazonDynamoDBFullAccess policy to the IAM role  from above. Note that you&#x2019;ll need to do this regardless of whether or not  you are using the first-time demo setup.</p></li>
  
<li>
<p>The WAR file you need to upload will be in the <tt>target</tt> directory after  you run <tt>mvn package</tt></p></li>
  
<li>
<p>There are some settings that you should probably change (although these are  entirely optional):</p>
  
<ul>
    
<li>Change the instance type from the default of T1.micro to T2.micro. The T2  version has more RAM, performs slightly better, and costs less (!!!)</li>
    
<li>You can change the environment settings to allow more RAM for the Tomcat  process. If you are using T2.micro as above, you can set the initial JVM  heap size to &#x201c;512m&#x201d; and the Maximum JVM heap size to &#x201c;800m&#x201d;</li>
  </ul></li>
</ul></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2015
                        <a href="https://github.com/memphis-iis">Institute for Intelligent Systems</a>.
            All Rights Reserved.      
                    
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
