<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2015-05-04
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20150504" />
    <meta http-equiv="Content-Language" content="en" />
    <title>demosurvey - </title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Demo-Survey</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2015-05-04</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 0.0.1-SNAPSHOT</li>
                      
                
                    
      
                                              
    <li class="pull-right">              <a href="http://aws.amazon.com/documentation/" class="externalLink" title="AWS Documentation">
        AWS Documentation</a>
  </li>

        <li class="divider pull-right">|</li>
      
    <li class="pull-right">              <a href="https://github.com/memphis-iis/demo-survey/" class="externalLink" title="GitHub Repo">
        GitHub Repo</a>
  </li>

        <li class="divider pull-right">|</li>
      
    <li class="pull-right">              <a href="http://www.memphis.edu/iis/" class="externalLink" title="IIS">
        IIS</a>
  </li>

                        </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Main Information</li>
                                
      <li>
    
                          <a href="index.html" title="Introduction and Overview">
          <i class="none"></i>
        Introduction and Overview</a>
            </li>
                  
      <li class="active">
    
            <a href="#"><i class="none"></i>Design Walkthrough</a>
          </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                          
      <li>
    
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                                                                                            
      <li>
    
                          <a href="project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Design Walkthrough</h1>
<p>You can get a general overview of this project, what is required to run it, and how to set it up in <a href="index.html">Introduction and Overview</a>.</p>
<p>However, just knowing that this a Java web application built with Maven doesn&#x2019;t necessarily tell you or why the application is structured in one way or another. Let&#x2019;s take a second and cover some of the major design points.</p>
<div class="section">
<h2>MVC<a name="MVC"></a></h2>
<p>This application is designed around a very lightweight implementation of the <a class="externalLink" href="http://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller">Model-View-Controller</a> pattern (also know by the initialism MVC . In essence, we build a &#x201c;model&#x201d; representing the entities our software is really interested in (in this case, a survey) and various &#x201c;views&#x201d; that we present to the user. Standing between these two pieces of functionality are our &#x201c;controllers&#x201d;.</p>
<p>In a web application built with an MVC pattern, you will generally see something that maps the URL&#x2019;s of incoming requests to a piece of code. That controller looks at the request, does something that generally involves the model, and then chooses the view to render to the user.</p>
<p>In this application, we use Servlet annotations to map a URL to a Servlet where the <tt>doGet</tt> and <tt>doPost</tt> methods handle the appropriate action. The Survey class functions as our model, and the JSP files in WEB-INF/Views. As an example, let&#x2019;s walk through what happens to fill out a survey:</p>

<ol style="list-style-type: decimal">
  
<li>A user requests something from the URL <tt>/demo-survey/home</tt>. Everything starting <tt>/demo-survey</tt> is mapped to our application. Our <tt>HomeServlet</tt> class extends <tt>HttpServlet</tt> via our helper base class <tt>BaseServlet</tt> <b>and</b> is annotated: <tt>@WebServlet(value=&quot;/home&quot;, loadOnStartup=1)</tt> so that the server knows to use class to handle this request.</li>
  
<li>Since this is an &#x201c;ordinary&#x201d; GET request, the <tt>doGet</tt> method is called on an instance of <tt>HomeServlet</tt>.</li>
  
<li>That method gets a default <tt>Survey</tt> instance, makes it available to views, and choose the view to render. In this case that view is <tt>/WEB-INF/view/home.jsp</tt></li>
  
<li>The page <tt>home.jsp</tt> is rendered like any other JSP page using JSTL. Note that it (like all our views) uses a &#x201c;base page&#x201d; tag that we created to centralize UI layout/design. You can see the tag in <tt>/WEB-INF/tags/basepage.tag</tt></li>
  
<li>The user fills out the survey and submits the form. We&#x2019;ll ignore the client-side validation for now.</li>
  
<li>If you look at the HTML form, you&#x2019;ll notice that it specifies <tt>method=&quot;POST&quot;</tt> but not <tt>action</tt> attribute. As a result, when the form is submitted it will be a POST request to the same URL.</li>
  
<li>As you can probably guess, the <tt>doPost</tt> method on the same class <tt>HomeServlet</tt> is called.</li>
  
<li>If there is an error saving the survey, the error view is rendered. If everything is fine, then a <b>redirect</b> is issued. This is known as the PRG pattern (Post, Redirect, Get) and is to make sure that (among other things) duplicate saves don&#x2019;t occur. You can read about it in depth here: <a class="externalLink" href="http://en.wikipedia.org/wiki/Post/Redirect/Get">PRG Pattern</a>.</li>
  
<li>We&#x2019;ll just assume that the survey was saved successfully. In that case, that browser is redirected to <tt>/demo-survey/thanks</tt>. Using the same logic as #1 above, we know this request will be routed to the <tt>doGet</tt> method of the <tt>ThanksServlet</tt> &#x201c;controller&#x201d; which will render the view <tt>/WEB-INF/view/thanks.jsp</tt></li>
</ol></div>
<div class="section">
<h2>Configuration<a name="Configuration"></a></h2>
<p>Generally a large application will have multiple layers of configuration. For instance, there might be a default or &#x201c;base&#x201d; set of configuration values in a file in <tt>src/main/resources</tt> (which would be deployed with the application). Environment variables or external configuration files would provide a means to customize the application. This is generally used for running the application (at a minimum) in a &#x201c;development&#x201d; mode (on your workstation), a &#x201c;test&#x201d; mode, and a &#x201c;production&#x201d; mode.</p>
<p>This application doesn&#x2019;t really require much configuration. In fact, because we work with the default values in most situations, there is currently only one configuration value needed. The class <tt>DataStoreClient</tt> checks for the Java system property <tt>aws.dynamoEndpoint</tt>. This value isn&#x2019;t specified by Amazon Elastic Beanstalk. This is fine because the default endpoint for DynamoDB is to use the &#x201c;correct&#x201d; one for Amazon.</p>
<p>The issue is testing on our local workstation. Since we don&#x2019;t have access to the AWS cloud, we run a local version of DynamoDB (see &#x201c;Setting up your development workstation&#x201d; in <a href="index.html">Introduction and Overview</a> for details). Luckily, the Tomcat plugin for Maven we use allows us to set Java system properties. If you look at the <tt>&lt;build&gt;</tt> section of the <tt>pom.xml</tt> file, you&#x2019;ll see this:</p>

<div class="source">
<pre>&lt;plugin&gt;
    &lt;groupId&gt;org.apache.tomcat.maven&lt;/groupId&gt;
    &lt;artifactId&gt;tomcat7-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;2.1&lt;/version&gt;
    &lt;configuration&gt;
        &lt;useTestClasspath&gt;true&lt;/useTestClasspath&gt;
        &lt;!-- We set these system properties for testing on a local workstation --&gt;
        &lt;systemProperties&gt;
            &lt;aws.accessKeyId&gt;TEST&lt;/aws.accessKeyId&gt;
            &lt;aws.secretKey&gt;TEST&lt;/aws.secretKey&gt;
            &lt;aws.dynamoEndpoint&gt;http://localhost:8000&lt;/aws.dynamoEndpoint&gt;
        &lt;/systemProperties&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;
</pre></div>
<p>You can see that we also specify spurious values for the AWS Access Key ID and Secret Key. These are usually handled for you on Elastic Beanstalk, but we need to specify <i>something</i> for the local DynamoDB. <b><i>Pro Tip:</i></b> the key name TEST is used as part of the SQLite database named created by the Local DynamoDB.</p>
<p>One final note on configuration: modern Java applications generally use a development pattern called &#x201c;Inversion of Control&#x201d; and then configure the software components at runtime using another, similar pattern called &#x201c;Dependency Injection&#x201d; (often abbreviated IoC or DI). This particular pattern wasn&#x2019;t used for this application since the general complexity of this application was already pretty high. However, interested readers may want to read Martin Fowler&#x2019;s article <a class="externalLink" href="http://martinfowler.com/articles/injection.html">Inversion of Control Containers and the Dependency Injection pattern</a>.</p>
<p>In our case, the class DataStoreClient might not continue to create its own instances of the classes. <tt>AmazonDynamoDBClient</tt>, <tt>DynamoDB</tt>, and <tt>DynamoDBMapper</tt>. In addition, the controllers (servlets) that just create a new instance of DataStoreClient would be &#x201c;given&#x201d; the instance to use. All of which brings us to the data design.</p></div>
<div class="section">
<h2>Data Overview (including the model and DAO classes)<a name="Data_Overview_including_the_model_and_DAO_classes"></a></h2>
<p>Like most applications our handling of data begins with the model. In our case, that&#x2019;s the class <tt>Survey</tt>. In this situation, we begin with the assumption that we are always going to use Amazon DynamoDB for our data storage. As a result, we go ahead and annotate <tt>Survey</tt> to indicate the DynamoDB table we&#x2019;ll use, which attribute is the key (it&#x2019;s <tt>participantCode</tt>), name the other attributes, and specify attributes that should be ignored when loading or saving a survey (<tt>isValid</tt> shouldn&#x2019;t be written to the database).</p>
<p>Our annotated model means that we can use the &#x201c;high level&#x201d; data model that Amazon provides for DynamoDB. The curious and industrious can find loads of details in the Amazon documentation <a class="externalLink" href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/ORM.html">here</a>.</p>
<p>However, we still need to answer a few questions:</p>

<ol style="list-style-type: decimal">
  
<li>How will our initial database get created?</li>
  
<li>Where will the code to read/write our data &#x201c;live&#x201d;?</li>
</ol>
<p>The initial answer to both questions is our <tt>DataStoreClient</tt> class. This class loosely follows the <a class="externalLink" href="http://en.wikipedia.org/wiki/Data_access_object">Data Access Object pattern</a> which is often referred to as &#x201c;DAO&#x201d;. In the name of clarity, our DAO is fairly concrete. If for some reason you wanted to support multiple data backends, you would want multiple implementation of the <tt>DataStoreClient</tt>. Regardless, our DAO makes available three actions:</p>

<ol style="list-style-type: decimal">
  
<li><tt>ensureSchema</tt> which creates any missing tables</li>
  
<li><tt>saveSurvey</tt> which saves a single instance of <tt>Survey</tt></li>
  
<li><tt>findSurveys</tt> which returns a <tt>List</tt> of the saved <tt>Survey</tt> instances.</li>
</ol>
<p>When and where the save/find method are called is fairly obvious and can be seen in the servlet/controller classes <tt>HomeServlet</tt> and <tt>DataDumpServlet</tt>. The slightly more mysterious method is for initially creating the database. It works via a combination of things:</p>

<ol style="list-style-type: decimal">
  
<li>The static variable <tt>TABLES</tt> has a list of all DynamoDB-annotated &#x201c;tables&#x201d; (which are just classes from our model) to be created.</li>
  
<li>We call the method from the <tt>init</tt> method of the <tt>HomeServlet</tt> class</li>
  
<li>We make sure that of all our servlets, the <tt>loadOnStartup</tt> attribute of the <tt>@WebServlet</tt> annotation is the <b>lowest</b>.</li>
</ol>
<p>Any Java web server our application runs on will make sure that the load order for servlets is sorted by loadOnStartup. It will also insure that the <tt>init</tt> method on any servlet is called only once. The final result is that every time our application starts up, the first thing we do is check to ensure that the database is created.</p></div>
<div class="section">
<h2>Logging<a name="Logging"></a></h2>
<p>An important component to any application that will run on a server is how information will be logged. Currently we use the fairly standard <a class="externalLink" href="http://www.slf4j.org/">SLF4J</a> logging framework. You can get an excellent introduction via the succinct <a class="externalLink" href="http://www.slf4j.org/manual.html">SLF4J user manual</a>. The basics are that you log to the SLF4J API and select a logging &#x201c;backend&#x201d; at runtime.</p>
<p>In Elastic Beanstalk Java applications, the Tomcat server has been modified to use the <tt>java.util.logging</tt> log facilities, which SLF4J can use. For local testing, we use the excellent logback-classic library.</p></div>
<div class="section">
<h2>Testing<a name="Testing"></a></h2>
<p>Like most application, we have included unit tests as a gentle introduction to jUnit. You&#x2019;ll note that Maven will automatically run the unit tests for you if you forget. They can also be run in the jUnit view in most IDE&#x2019;s (although only Eclipse has been tested).</p>
<p>In attempt to keep the complexity low, no there aren&#x2019;t as many unit tests as there might be in a &#x201c;real&#x201d; application. For the sake of this demo, we are side-stepping the question of how to unit test views or controllers, and we haven&#x2019;t included any integration tests that might check our DAO classes.</p></div>
<div class="section">
<h2>Static Analysis<a name="Static_Analysis"></a></h2>
<p>Although a Java web application might seem complex, once you have all the various pieces together, it&#x2019;s fairly easy to add some impressive software engineering tools. As an example, we demonstrate how to add static analysis to your application.</p>
<p>In our case, we&#x2019;ve added a <a class="externalLink" href="http://findbugs.sourceforge.net/">FindBugs</a> report via the <a class="externalLink" href="http://gleclaire.github.io/findbugs-maven-plugin/">FindBugs Maven Plugin</a>. Although this may seem complicated, it&#x2019;s really quite simple. We added the FindBugs plugin to the <tt>&lt;reporting&gt;</tt> section and the report is included as part of our site generation. We have helpfully left in code to flag a FindBugs message so that you can see an example of the kind of help it can provide. Of course, this is fairly mild example since we want the application to actually function!</p>
<p>Interested readers may want to look at the list of Java static analysis tools at <a class="externalLink" href="http://en.wikipedia.org/wiki/List_of_tools_for_static_code_analysis#Java">this Wikipedia page</a>. Of those listed, two very popular tools in industry are: <a class="externalLink" href="https://maven.apache.org/plugins/maven-checkstyle-plugin/">Checkstyle</a> and <a class="externalLink" href="http://www.javavillage.in/PMD-CPD-in-maven.php">PMD</a>.</p></div>
<div class="section">
<h2>Project Reports<a name="Project_Reports"></a></h2>
<p>Be sure to check out the <a href="project-reports.html">Project Reports</a> in the site generated. It includes the JavaDocs generated from the JavaDoc comments in the source code, the output from running the unit tests, the FindBugs report mentioned above and more.</p></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2015
                        <a href="https://github.com/memphis-iis">Institute for Intelligent Systems</a>.
            All Rights Reserved.      
                    
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
